{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/main.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\n############################################################################################################\nGUY                       = require 'guy'\n{ alert\n  debug\n  help\n  info\n  plain\n  praise\n  urge\n  warn\n  whisper }               = GUY.trm.get_loggers 'DEMO-MOO-LEXER'\n{ rpr\n  inspect\n  echo\n  log     }               = GUY.trm\n#...........................................................................................................\n{ equals\n  copy_regex }            = GUY.samesame\n{ Moonriver }             = require 'moonriver'\n{ $window }               = require 'moonriver/lib/transforms'\n{ $ }                     = Moonriver\n\n\n#===========================================================================================================\nclass Token\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( cfg ) ->\n    return undefined\n\n\n#===========================================================================================================\nclass Lexer\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( cfg ) ->\n    @cfg                = cfg\n    GUY.props.hide @, 'types', ( require './types' ) @cfg\n    @[Symbol.iterator]  = @walk.bind @\n    state               = @reset()\n    @_compile()\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  reset: -> @state =\n    position:   0\n    chunk:      ''\n\n  #---------------------------------------------------------------------------------------------------------\n  _compile: ->\n    for token, cfg of @cfg.tokens\n      entry = @types.create.lxr_token_cfg cfg\n      # debug '^5435^', { token, cfg, entry, }\n      @cfg.tokens[ token ] = entry\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  read: ( source ) ->\n    @reset()\n    @feed source\n    @finish()\n    return [ @walk()..., ]\n\n  #---------------------------------------------------------------------------------------------------------\n  feed: ( chunk ) ->\n    # @types.validate.text chunk ### TAINT also allow buffers ###\n    @state.chunk = chunk\n    return @\n\n  #---------------------------------------------------------------------------------------------------------\n  walk: ->\n    last_position = @state.chunk.length - 1\n    loop\n      break if @state.position > last_position\n      match = null\n      for token, entry of @cfg.tokens\n        entry.matcher.lastIndex = @state.position\n        continue unless ( match = @state.chunk.match entry.matcher )?\n        yield { token, text: match[ 0 ], }\n        break\n      throw new Error \"no match\" unless match?\n      @state.position += match[ 0 ].length\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _create_walker: ->\n    last_position = null\n    #.......................................................................................................\n    walker = ->\n      loop\n        break if @state.position > last_position\n        match = null\n        for token, entry of @cfg.tokens\n          debug '^34345345^', @state.chunk\n          debug '^34345345^', @state.position, token\n          entry.matcher.lastIndex = @state.position\n          continue unless ( match = @state.chunk.match entry.matcher )?\n          yield { token, text: match[ 0 ], }\n          break\n        throw new Error \"no match\" unless match?\n        @state.position += match[ 0 ].length\n      return null\n    #.......................................................................................................\n    R = ( walker.bind @ )()\n    R.reset = =>\n      last_position   = @state.chunk.length - 1\n      @state.position = 0\n      # @reset()\n      return null\n    #.......................................................................................................\n    R.reset()\n    return R\n\n  #---------------------------------------------------------------------------------------------------------\n  _create_pipeline: ->\n    # last          = Symbol 'last'\n    walker  = null\n    mr      = new Moonriver()\n    mr.push show = ( d ) -> urge '^49-1^', d\n    mr.push xxx = ( source ) =>\n      @state.chunk = source\n      walker = @_create_walker()\n    mr.push show = ( d ) -> urge '^49-2^', d\n    mr.push xxx = ( d, send ) =>\n      # debug '^342^', d for d from @walk()\n      # info '^342^', d for d from @_create_walker()\n      # debug '^342^', @state\n      send token for token from walker\n    mr.push $window -1, +1, null\n    mr.push show = ( d ) -> urge '^49-3^', d\n    # mr.push store = ( d ) => @state.tokens.push d\n    return mr\n\n  #---------------------------------------------------------------------------------------------------------\n  finish: ->\n    return null\n\n\n############################################################################################################\nmodule.exports = { Token, Lexer, }\n"
  ]
}